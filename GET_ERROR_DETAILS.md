# 500 에러 상세 정보 확인 방법

## 현재 상황
`/api/calories` 엔드포인트에서 **500 Internal Server Error**가 발생하고 있습니다.
API 키는 정상적으로 설정되어 있지만, 실제 칼로리 계산 시 오류가 발생합니다.

## 필수 확인 사항

### 1. 브라우저 Network 탭에서 Response 확인 (가장 중요!)

1. 브라우저에서 **F12** 키를 눌러 개발자 도구 열기
2. **Network** 탭 선택
3. 기록 등록 페이지에서 식사를 입력
4. `/api/calories` 요청을 클릭
5. **Response** 탭 선택하여 응답 본문 확인

**응답 예시:**
```json
{
  "error": "칼로리 계산에 실패했습니다...",
  "details": "..."
}
```

또는

```json
{
  "error": "서버 오류가 발생했습니다: ...",
  "errorType": "...",
  "details": "..."
}
```

**이 Response 내용을 복사해서 알려주세요!**

### 2. 서버 터미널 로그 확인

`npm run dev`를 실행한 터미널에서:

**식사를 입력할 때 표시되는 로그를 확인하세요:**

예상되는 로그 패턴:

#### 정상적인 경우:
```
📝 칼로리 계산 API 호출: 치킨 한 마리
🔑 GEMINI_API_KEY 확인: 설정됨 (길이: 39)
🔄 칼로리 계산 시작...
🔍 칼로리 계산 시작: 치킨 한 마리
✅ Gemini 모델 초기화 완료: gemini-1.5-flash
📥 Gemini API 원본 응답: 1200
✅ 칼로리 계산 성공: 1200 kcal
```

#### 문제가 있는 경우:
```
📝 칼로리 계산 API 호출: 치킨 한 마리
🔑 GEMINI_API_KEY 확인: 설정됨 (길이: 39)
🔄 칼로리 계산 시작...
❌ Gemini API 오류 발생!
❌ 오류 메시지: [에러 내용]
```

**서버 터미널의 전체 에러 로그를 복사해서 알려주세요!**

## 가능한 원인

### 원인 1: Gemini API 호출 실패
- API 키가 잘못되었거나 권한이 없음
- 네트워크 연결 문제
- Gemini API 서비스 장애

### 원인 2: API 응답 파싱 실패
- Gemini API가 숫자가 아닌 형식으로 응답
- 응답 형식이 예상과 다름

### 원인 3: 예상치 못한 오류
- 모델 초기화 실패
- 타임아웃
- 기타 런타임 오류

## 다음 단계

다음 정보를 알려주시면 정확한 원인을 파악할 수 있습니다:

1. **브라우저 Network 탭의 Response 내용** (가장 중요!)
   - `/api/calories` 요청의 Response 탭 내용 전체

2. **서버 터미널의 에러 로그**
   - 식사를 입력할 때 표시되는 모든 로그
   - 특히 `❌` 표시가 있는 부분

3. **브라우저 콘솔의 에러 메시지**
   - F12 > Console 탭의 빨간색 에러 메시지

## 빠른 테스트

브라우저에서 다음 URL을 열어보세요:
```
http://localhost:3000/api/calories/test
```

이 페이지에서 API 키 상태를 확인할 수 있습니다.

## 임시 해결 방법

만약 Gemini API 호출이 계속 실패한다면:

1. **API 키 재확인**
   - [Google AI Studio](https://makersuite.google.com/app/apikey)에서 API 키 확인
   - 새 API 키 발급 후 `.env` 파일 업데이트

2. **네트워크 확인**
   - 인터넷 연결이 정상인지 확인
   - 방화벽이나 프록시가 Gemini API를 차단하지 않는지 확인

3. **서버 재시작**
   ```bash
   # 서버 중지
   Ctrl + C
   
   # 서버 재시작
   npm run dev
   ```

## 요청

**다음 정보를 알려주세요:**

1. 브라우저 Network 탭의 `/api/calories` Response 내용
2. 서버 터미널의 에러 로그 (식사 입력 시 표시되는 모든 로그)
3. 브라우저 콘솔의 에러 메시지

이 정보를 주시면 정확한 원인을 파악하고 해결 방법을 제시할 수 있습니다.
