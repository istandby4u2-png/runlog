# API 키 상태 응답 설명

## 응답 분석

```json
{
  "status": "ok",
  "geminiApiKey": {
    "exists": true,
    "length": 39,
    "preview": "AIzaSyCz-Z..."
  },
  "message": "✅ GEMINI_API_KEY가 설정되어 있습니다.",
  "instructions": "칼로리 계산 기능을 사용할 수 있습니다."
}
```

## 의미

### ✅ 좋은 신호
- **`exists: true`**: GEMINI_API_KEY가 `.env` 파일에 설정되어 있고 서버가 인식하고 있습니다
- **`length: 39`**: API 키 길이가 정상입니다 (Google API 키는 보통 39자입니다)
- **`preview: "AIzaSyCz-Z..."`**: API 키의 앞부분이 올바르게 표시됩니다

### 결론
**API 키 설정은 정상입니다!** 환경 변수는 제대로 로드되고 있습니다.

## 다음 단계

API 키가 설정되어 있는데도 칼로리 계산이 실패한다면, 다른 원인일 수 있습니다:

### 가능한 원인 1: Gemini API 호출 실패
- API 키가 잘못되었거나 권한이 없을 수 있습니다
- 네트워크 연결 문제일 수 있습니다
- Gemini API 서비스 장애일 수 있습니다

### 가능한 원인 2: API 응답 파싱 문제
- Gemini API가 숫자가 아닌 형식으로 응답했을 수 있습니다
- 응답 형식이 예상과 다를 수 있습니다

## 확인 방법

### 1. 실제 칼로리 계산 테스트
기록 등록 페이지에서 식사를 입력하고, 서버 터미널의 로그를 확인하세요:

**정상적인 경우:**
```
📝 칼로리 계산 API 호출: 치킨 한 마리
🔑 GEMINI_API_KEY 확인: 설정됨 (길이: 39)
🔄 칼로리 계산 시작...
🔍 칼로리 계산 시작: 치킨 한 마리
✅ Gemini 모델 초기화 완료: gemini-1.5-flash
📥 Gemini API 원본 응답: 1200
✅ 칼로리 계산 성공: 1200 kcal
```

**문제가 있는 경우:**
```
❌ Gemini API 오류 발생!
❌ 오류 메시지: [에러 내용]
```

### 2. 서버 터미널 로그 확인
식사를 입력할 때 서버 터미널에 어떤 메시지가 표시되는지 확인하세요.

### 3. 브라우저 콘솔 확인
1. F12 키를 눌러 개발자 도구 열기
2. Console 탭에서 에러 메시지 확인
3. Network 탭에서 `/api/calories` 요청의 Response 확인

## 해결 방법

### API 키가 설정되어 있는데도 실패하는 경우:

1. **API 키 유효성 확인**
   - [Google AI Studio](https://makersuite.google.com/app/apikey)에서 API 키가 활성화되어 있는지 확인
   - API 키가 제한되어 있지 않은지 확인

2. **서버 터미널 로그 확인**
   - `❌ Gemini API 오류 발생!` 메시지가 있는지 확인
   - 에러 메시지의 전체 내용 확인

3. **네트워크 확인**
   - 인터넷 연결이 정상인지 확인
   - 방화벽이나 프록시가 Gemini API를 차단하지 않는지 확인

## 현재 상태

✅ **API 키 설정: 정상**
- 환경 변수가 제대로 로드되고 있습니다
- 서버가 API 키를 인식하고 있습니다

다음으로 확인할 것:
- 실제 칼로리 계산 시 서버 터미널의 로그
- 브라우저 콘솔의 에러 메시지
- Gemini API 호출이 성공하는지 여부

## 요청 사항

API 키는 정상이므로, 다음 정보를 알려주시면 추가 문제를 진단할 수 있습니다:

1. **기록 등록 페이지에서 식사를 입력할 때** 어떤 일이 발생하는지
2. **서버 터미널의 로그** (특히 `❌` 표시가 있는 부분)
3. **브라우저 콘솔의 에러 메시지**
4. **브라우저 Network 탭의 Response 내용** (`/api/calories` 요청)

이 정보를 주시면 정확한 원인을 파악할 수 있습니다.
