# Gemini API 호출 실패 해결 가이드

## 적용된 해결 방법

### 1. 모델 이름 변경
- `gemini-1.5-flash` 대신 `gemini-pro`를 먼저 시도
- `gemini-pro`가 실패하면 `gemini-1.5-flash`로 폴백
- 두 모델 모두 실패하면 명확한 에러 메시지 표시

### 2. 더 자세한 로깅
- API 호출 시작/성공 로그 추가
- 사용 중인 모델 이름 표시
- 프롬프트 길이 확인

### 3. 개선된 에러 처리
- GoogleGenerativeAI 특정 에러 코드 확인
- API 응답 상세 정보 출력
- 일반적인 에러 원인 안내

## 다음 단계

### 1. 서버 재시작
```bash
# 서버 중지
Ctrl + C

# 서버 재시작
npm run dev
```

### 2. 테스트
기록 등록 페이지에서 식사를 입력하고, 서버 터미널의 로그를 확인하세요.

**예상되는 로그:**
```
📝 칼로리 계산 API 호출: 치킨 한 마리
🔑 GEMINI_API_KEY 확인: 설정됨 (길이: 39)
🔄 칼로리 계산 시작...
🔍 칼로리 계산 시작: 치킨 한 마리
📤 Gemini API 호출 시작...
📤 사용 모델: gemini-pro
📤 프롬프트 길이: 234
📥 Gemini API 호출 성공
📥 Gemini API 원본 응답: 1200
✅ 칼로리 계산 성공: 1200 kcal
```

### 3. 여전히 실패하는 경우

#### 방법 1: API 키 재확인
1. [Google AI Studio](https://makersuite.google.com/app/apikey) 접속
2. API 키가 활성화되어 있는지 확인
3. 새 API 키 발급 (필요한 경우)
4. `.env` 파일 업데이트
5. 서버 재시작

#### 방법 2: API 키 권한 확인
1. [Google Cloud Console](https://console.cloud.google.com/) 접속
2. API 및 서비스 > 사용자 인증 정보
3. API 키 클릭하여 편집
4. API 제한사항에서 "제한 없음" 또는 "Generative Language API" 확인

#### 방법 3: 네트워크 확인
- 인터넷 연결이 정상인지 확인
- 방화벽이나 프록시가 Gemini API를 차단하지 않는지 확인
- VPN을 사용 중이라면 일시적으로 끄고 테스트

## 서버 터미널 로그 확인

서버 터미널에서 다음을 확인하세요:

1. **모델 초기화:**
   - `✅ Gemini 모델 초기화 완료: gemini-pro` 또는
   - `✅ Gemini 모델 초기화 완료: gemini-1.5-flash`

2. **API 호출:**
   - `📤 Gemini API 호출 시작...`
   - `📥 Gemini API 호출 성공` 또는
   - `❌ Gemini API 오류 발생!`

3. **에러 메시지:**
   - `❌ 오류 메시지:` 뒤의 내용
   - `❌ HTTP 상태:` 코드
   - `❌ 에러 코드:` (있는 경우)

## 일반적인 에러와 해결 방법

### 에러 1: "API_KEY_INVALID"
**원인:** API 키가 잘못되었거나 만료됨
**해결:** 새 API 키 발급 후 `.env` 파일 업데이트

### 에러 2: "PERMISSION_DENIED"
**원인:** API 키에 권한이 없음
**해결:** Google Cloud Console에서 API 키 권한 확인

### 에러 3: "QUOTA_EXCEEDED"
**원인:** API 할당량 초과
**해결:** 할당량이 복구될 때까지 대기하거나 유료 플랜으로 업그레이드

### 에러 4: "NETWORK_ERROR" 또는 "FETCH_ERROR"
**원인:** 네트워크 연결 문제
**해결:** 인터넷 연결 확인, 방화벽/프록시 설정 확인

## 확인 요청

서버를 재시작한 후:

1. 기록 등록 페이지에서 식사를 입력
2. 서버 터미널의 로그 확인
3. 어떤 메시지가 표시되는지 알려주세요

특히 다음을 확인해주세요:
- 모델 초기화가 성공했는지
- API 호출이 시작되었는지
- 어떤 에러 메시지가 표시되는지

이 정보를 주시면 추가 해결 방법을 제시할 수 있습니다.
